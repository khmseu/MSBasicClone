<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MSBasic - Applesoft BASIC Interpreter: MSBasic Implementation Status</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MSBasic - Applesoft BASIC Interpreter<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A modern C++20 implementation of Applesoft II BASIC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2features.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MSBasic Implementation Status</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md100"></a> This document tracks the implementation status of Applesoft BASIC compatibility in MSBasic.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md102"></a>
Part 1: Implementation Status (Todo-List Style)</h1>
<h2><a class="anchor" id="autotoc_md103"></a>
Core Architecture</h2>
<ul>
<li>[x] <a class="el" href="classTokenizer.html" title="Converts BASIC source code into a stream of tokens.">Tokenizer</a> → <a class="el" href="classParser.html" title="Recursive descent parser for BASIC syntax.">Parser</a> → <a class="el" href="classInterpreter.html" title="Runtime execution engine for Applesoft BASIC programs.">Interpreter</a> pipeline</li>
<li>[x] Shared AST for interactive and program execution</li>
<li>[x] Custom 40-bit floating point (<code>src/float40.*</code>)</li>
<li>[x] Number/string <code><a class="el" href="classValue.html" title="Runtime value that can hold either a number or a string.">Value</a></code> type system</li>
<li>[x] Variable name normalization (2 chars significant, case-insensitive)</li>
<li>[x] String variables (<code>$</code> suffix)</li>
<li>[x] Integer variables (<code>%</code> suffix, 16-bit signed range)</li>
<li>[x] Multiple statements per line (colon <code>:</code> separator)</li>
</ul>
<h2><a class="anchor" id="autotoc_md104"></a>
Expression Evaluation</h2>
<ul>
<li>[x] Arithmetic operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code></li>
<li>[x] String concatenation: <code>+</code> operator for strings</li>
<li>[x] MOD operator</li>
<li>[x] Unary operators: <code>+</code>, <code>-</code>, <code>NOT</code></li>
<li>[x] Comparison operators: <code>=</code>, <code>&lt;&gt;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></li>
<li>[x] Logical operators: <code>AND</code>, <code>OR</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md105"></a>
Standard Applesoft Commands</h2>
<h3><a class="anchor" id="autotoc_md106"></a>
Control Flow</h3>
<ul>
<li>[x] GOTO line_number</li>
<li>[x] GOSUB line_number</li>
<li>[x] RETURN</li>
<li>[x] ON expression GOTO/GOSUB line_number[,line_number...]</li>
<li>[x] IF condition THEN statement/line_number</li>
<li>[x] IF...THEN...ELSE</li>
<li>[x] FOR variable = start TO end [STEP increment]</li>
<li>[x] NEXT [variable]</li>
<li>[x] WHILE condition</li>
<li>[x] WEND</li>
<li>[x] END</li>
<li>[x] STOP</li>
<li>[x] CONT</li>
<li>[x] POP</li>
</ul>
<h3><a class="anchor" id="autotoc_md107"></a>
Variable and Data Management</h3>
<ul>
<li>[x] LET variable = expression (LET is optional)</li>
<li>[x] DIM array(size[,size...])</li>
<li>[x] Arrays auto-dimension to size 10 if undeclared</li>
<li>[x] DATA value[,value...]</li>
<li>[x] READ variable[,variable...]</li>
<li>[x] RESTORE [line_number]</li>
<li>[x] CLR (same as CLEAR)</li>
<li>[x] CLEAR</li>
</ul>
<h3><a class="anchor" id="autotoc_md108"></a>
User-Defined Functions</h3>
<ul>
<li>[x] DEF FN name(parameter) = expression</li>
<li>[x] FN name(argument) - function calls</li>
</ul>
<h3><a class="anchor" id="autotoc_md109"></a>
Input/Output</h3>
<ul>
<li>[x] PRINT [expression[;|,expression]...]</li>
<li>[x] ? (shorthand for PRINT)</li>
<li>[x] INPUT ["prompt";] variable[,variable...]</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921af684bf05fa3e81528c84d1d281d839f1">TAB(n)</a> - output spacing</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921aa9ba851e539886467d4ecfddca93f414">SPC(n)</a> - output spacing</li>
<li>[x] Semicolon separator (tight spacing)</li>
<li>[x] Comma separator (tab positions)</li>
</ul>
<h3><a class="anchor" id="autotoc_md110"></a>
Program Management</h3>
<ul>
<li>[x] NEW - clear program</li>
<li>[x] RUN [line_number]</li>
<li>[x] LIST [start[,end]]</li>
<li>[x] DEL start,end - delete line range</li>
<li>[x] REM comment</li>
</ul>
<h3><a class="anchor" id="autotoc_md111"></a>
File Operations</h3>
<ul>
<li>[x] LOAD filename</li>
<li>[x] SAVE filename</li>
<li>[x] CATALOG</li>
<li>[x] RECALL arrayname - load array from file</li>
<li>[x] STORE arrayname - save array to file</li>
</ul>
<h3><a class="anchor" id="autotoc_md112"></a>
Screen Control</h3>
<ul>
<li>[x] HOME - clear screen and home cursor</li>
<li>[x] HTAB column - horizontal tab</li>
<li>[x] VTAB row - vertical tab</li>
<li>[x] INVERSE - inverse video mode</li>
<li>[x] NORMAL - normal video mode</li>
<li>[x] FLASH - flashing text mode</li>
<li>[x] TEXT - switch to text mode</li>
</ul>
<h3><a class="anchor" id="autotoc_md113"></a>
Graphics - Low Resolution</h3>
<ul>
<li>[x] GR - 40x40 low-res graphics mode</li>
<li>[x] COLOR= expression - set plotting color (0-15)</li>
<li>[x] PLOT x,y - plot a point</li>
<li>[x] HLIN x1,x2 AT y - horizontal line</li>
<li>[x] VLIN y1,y2 AT x - vertical line</li>
</ul>
<h3><a class="anchor" id="autotoc_md114"></a>
Graphics - High Resolution</h3>
<ul>
<li>[x] HIRES - enable high-resolution graphics mode</li>
<li>[x] HGR - 280x192 hi-res graphics (mixed mode)</li>
<li>[x] HGR2 - 280x192 hi-res graphics (full screen)</li>
<li>[x] HCOLOR= expression - set hi-res color</li>
<li>[x] HPLOT x,y [TO x,y]... - plot points/lines</li>
<li>[x] MOVE x,y - move graphics cursor</li>
<li>[x] ROTATE angle - set rotation for shapes (0-63)</li>
<li>[x] SCALE size - set scale for shapes (1-255)</li>
<li>[x] DRAW shape_number [AT x,y] - draw shape</li>
<li>[x] XDRAW shape_number [AT x,y] - XOR draw shape</li>
<li>[x] SHLOAD - load shapes from DATA statements</li>
<li>[x] Shape table binary file loading</li>
</ul>
<h3><a class="anchor" id="autotoc_md115"></a>
Low-Level System Access</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(address)</a> - read memory byte</li>
<li>[x] POKE address,value - write memory byte</li>
<li>[x] CALL address - execute machine code</li>
<li>[x] GET variable - read single keystroke</li>
<li>[x] WAIT address,mask[,timeoutMs] - wait for memory condition</li>
</ul>
<h3><a class="anchor" id="autotoc_md116"></a>
Memory Management</h3>
<ul>
<li>[x] HIMEM: address - set high memory limit</li>
<li>[x] LOMEM: address - set low memory limit</li>
<li>[x] Memory bounds enforcement for PEEK/POKE/WAIT</li>
</ul>
<h3><a class="anchor" id="autotoc_md117"></a>
Error Handling</h3>
<ul>
<li>[x] ONERR GOTO line_number</li>
<li>[x] RESUME - continue after error</li>
<li>[x] Error code storage in memory location 222</li>
<li>[x] Error line storage in locations 218-219</li>
</ul>
<h3><a class="anchor" id="autotoc_md118"></a>
Debugging and Timing</h3>
<ul>
<li>[x] TRACE - show line numbers during execution</li>
<li>[x] NOTRACE - turn off tracing</li>
<li>[x] SPEED n - set execution speed delay (0-255 ms)</li>
<li>[x] RANDOMIZE seed - initialize RND</li>
</ul>
<h3><a class="anchor" id="autotoc_md119"></a>
Device Control</h3>
<ul>
<li>[x] PR# slot - set output device (stub)</li>
<li>[x] IN# slot - set input device (stub)</li>
</ul>
<h2><a class="anchor" id="autotoc_md120"></a>
ProDOS Commands</h2>
<h3><a class="anchor" id="autotoc_md121"></a>
File System Operations</h3>
<ul>
<li>[x] - (DASH) pn [,S#] [,D#] - run program without clearing variables</li>
<li>[x] APPEND pn - prepare file for appending</li>
<li>[x] BLOAD pn [,A#] [,S#] [,D#] - load binary file</li>
<li>[x] BRUN pn [,A#] [,S#] [,D#] - load and run binary file</li>
<li>[x] BSAVE pn,A#,L# [,S#] [,D#] - save binary file</li>
<li>[x] CAT [pn] [,S#] [,D#] - 40-column catalog</li>
<li>[x] CHAIN pn [,#] [,S#] [,D#] - run program keeping variables</li>
<li>[x] CLOSE [pn] - close file(s)</li>
<li>[x] CREATE pn [,Ttype] [,S#] [,D#] - create file/directory</li>
<li>[x] DELETE pn [,S#] [,D#] - delete file</li>
<li>[x] EXEC pn [,S#] [,D#] - execute text file commands</li>
<li>[x] FLUSH [pn] - flush file buffers</li>
<li>[x] LOCK pn [,S#] [,D#] - lock file</li>
<li>[x] UNLOCK pn [,S#] [,D#] - unlock file</li>
<li>[x] OPEN pn [,Llength] [,S#] [,D#] - open file</li>
<li>[x] POSITION pn [,Rrecord#] [,Bbyte#] - position in file</li>
<li>[x] PREFIX [pn] [,S#] [,D#] - set/show prefix</li>
<li>[x] READ pn [,Rrecord#] [,Bbyte#] - prepare file for reading</li>
<li>[x] RENAME pn1,pn2 [,S#] [,D#] - rename file</li>
<li>[x] ProDOS RESTORE pn [,S#] [,D#] - load variables from file</li>
<li>[x] ProDOS STORE pn [,S#] [,D#] - save variables to file</li>
<li>[x] WRITE pn [,Rrecord#] - prepare file for writing</li>
</ul>
<h2><a class="anchor" id="autotoc_md122"></a>
Built-in Functions</h2>
<h3><a class="anchor" id="autotoc_md123"></a>
Mathematical Functions</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a7d8a220d2262f9d6c658d549ee12cf2c">ABS(expression)</a> - absolute value</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a1b540be3b82571464ede49e939837587">ATN(expression)</a> - arctangent (radians)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921aef23ef1d426ae1a73a7eed399cef707d">COS(expression)</a> - cosine (radians)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a8c670f8c37b95e1ed14a0ce414b049c7">EXP(expression)</a> - e^x</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a53f93baa3057821107c750323892fa92">INT(expression)</a> - truncate to integer</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a4b5ffcdaf38ce4d463171f5c977c5ab3">LOG(expression)</a> - natural logarithm</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a477f9701a73bca06b17af65b469ecfda">RND(expression)</a> - random number</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a0c06907d970859d829df948d962ffdd0">SGN(expression)</a> - sign (-1, 0, or 1)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a5b001d63db54e7383587771eeb2018a1">SIN(expression)</a> - sine (radians)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a18e1c2e0bb7dfbfa5693566c43b15cc7">SQR(expression)</a> - square root</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a71211c96ad35b40178446956e22be10e">TAN(expression)</a> - tangent (radians)</li>
</ul>
<h3><a class="anchor" id="autotoc_md124"></a>
String Functions</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921ac6e421eaad140c1bc1a39980502df80c">ASC(string)</a> - ASCII code of first character</li>
<li>[x] CHR$(code) - character from ASCII code</li>
<li>[x] LEFT$(string, n) - leftmost n characters</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a6dd2477cccabf8da7a1e050374b1be17">LEN(string)</a> - string length</li>
<li>[x] MID$(string, start [,length]) - substring</li>
<li>[x] RIGHT$(string, n) - rightmost n characters</li>
<li>[x] STR$(expression) - convert number to string</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921adc62baefdb2838f1e2a64f8115940ce4">VAL(string)</a> - convert string to number</li>
</ul>
<h3><a class="anchor" id="autotoc_md125"></a>
System Functions</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a7b8419f19a58b307ad1cd9b9aa05e278">FRE(dummy)</a> - free memory (returns placeholder)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a4e0799443cae591e21badb40f9a20754">PDL(n)</a> - game paddle position (returns 0)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(address)</a> - read memory byte</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a1903f54cd46d54aa3200a4508c948db0">POS(dummy)</a> - cursor horizontal position</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921acc06370fc7df708112ed2e2a79bc3b4c">SCRN(x,y)</a> - read screen pixel color</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a2b6cc9c30eaad9c109091ea928529cbd">USR(expression)</a> - user machine code call (returns 0)</li>
</ul>
<h2><a class="anchor" id="autotoc_md126"></a>
Error Codes</h2>
<h3><a class="anchor" id="autotoc_md127"></a>
Standard Applesoft Error Codes</h3>
<ul>
<li>[x] Error code 0: NEXT without FOR</li>
<li>[x] Error code 16: Syntax</li>
<li>[x] Error code 22: RETURN without GOSUB</li>
<li>[x] Error code 42: Out of data</li>
<li>[x] Error code 53: Illegal quantity</li>
<li>[x] Error code 69: Overflow</li>
<li>[x] Error code 77: Out of memory</li>
<li>[x] Error code 90: Undefined statement</li>
<li>[x] Error code 107: Bad subscript</li>
<li>[x] Error code 120: Redimensioned array</li>
<li>[x] Error code 133: Division by zero</li>
<li>[x] Error code 163: Type mismatch</li>
<li>[x] Error code 176: String too long</li>
<li>[x] Error code 191: Formula too complex</li>
<li>[x] Error code 224: Undefined function</li>
<li>[x] Error code 254: Bad response to INPUT statement</li>
<li>[x] Error code 255: CONTROL-C interrupt attempted</li>
</ul>
<h3><a class="anchor" id="autotoc_md128"></a>
ProDOS Error Codes</h3>
<ul>
<li>[x] Error codes 2-21: ProDOS-specific errors</li>
<li>[x] RANGE ERROR (Code 2)</li>
<li>[x] NO DEVICE CONNECTED (Code 3)</li>
<li>[x] WRITE PROTECTED (Code 4)</li>
<li>[x] END OF DATA (Code 5)</li>
<li>[x] PATH NOT FOUND (Codes 6-7)</li>
<li>[x] I/O ERROR (Code 8)</li>
<li>[x] DISK FULL (Code 9)</li>
<li>[x] FILE LOCKED (Code 10)</li>
<li>[x] INVALID OPTION (Code 11)</li>
<li>[x] NO BUFFERS AVAILABLE (Code 12)</li>
<li>[x] FILE TYPE MISMATCH (Code 13)</li>
<li>[x] PROGRAM TOO LARGE (Code 14)</li>
<li>[x] NOT DIRECT COMMAND (Code 15)</li>
<li>[x] DIRECTORY FULL (Code 17)</li>
<li>[x] FILE NOT OPEN (Code 18)</li>
<li>[x] DUPLICATE FILENAME (Code 19)</li>
<li>[x] FILE BUSY (Code 20)</li>
<li>[x] FILE(S) STILL OPEN (Code 21)</li>
</ul>
<h3><a class="anchor" id="autotoc_md129"></a>
Error Handling Memory Locations</h3>
<ul>
<li>[x] Location 216/$D8: Error handler control (POKE 216,0 to restore)</li>
<li>[x] Location 218/$DA: Error line number (low byte)</li>
<li>[x] Location 219/$DB: Error line number (high byte)</li>
<li>[x] Location 222/$DE: Error code (0-255)</li>
</ul>
<h2><a class="anchor" id="autotoc_md130"></a>
PEEK/POKE/CALL Address Support</h2>
<h3><a class="anchor" id="autotoc_md131"></a>
Keyboard and Input</h3>
<ul>
<li>[x] PEEK(-16384)/PEEK(49152)/PEEK($C000) - last key pressed</li>
<li>[x] POKE -16368/49168/$C010 - clear keyboard strobe</li>
<li>[x] PEEK(-16287)/PEEK(49249)/PEEK($C061) - button 0 (&gt;127 if pressed)</li>
<li>[x] PEEK(-16286)/PEEK(49250)/PEEK($C062) - button 1 (&gt;127 if pressed)</li>
<li>[x] PEEK(-16285)/PEEK(49251)/PEEK($C063) - button 2 (&gt;127 if pressed)</li>
</ul>
<h3><a class="anchor" id="autotoc_md132"></a>
Memory Pointers</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(105)</a>/$69 - LOMEM pointer (low byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(106)</a>/$6A - LOMEM pointer (high byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(115)</a>/$73 - HIMEM pointer (low byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(116)</a>/$74 - HIMEM pointer (high byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(218)</a>/$DA - error line number (low byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(219)</a>/$DB - error line number (high byte)</li>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(222)</a>/$DE - error code</li>
</ul>
<h3><a class="anchor" id="autotoc_md133"></a>
Display Control</h3>
<ul>
<li>[x] <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a422982ae154d01bf45c66c601981e6c2">PEEK(37)</a>/$25 - cursor vertical position (0-23)</li>
<li>[x] POKE 32/$20 - text window left edge</li>
<li>[x] POKE 33/$21 - text window width</li>
<li>[x] POKE 34/$22 - text window top (0-23)</li>
<li>[x] POKE 37/$25 - cursor vertical position</li>
<li>[x] POKE -16368/49168/$C010 - clear keyboard strobe</li>
<li>[x] POKE -16304/49232/$C050 - switch to graphics without clearing</li>
<li>[x] POKE -16303/49233/$C051 - full screen graphics control</li>
<li>[x] POKE -16302/49234/$C052 - graphics mode control</li>
<li>[x] POKE -16301/49235/$C053 - mixed graphics/text mode</li>
<li>[x] POKE -16300/49236/$C054 - text mode control</li>
<li>[x] POKE -16299/49237/$C055 - undocumented display control</li>
<li>[x] POKE -16298/49238/$C056 - undocumented display control</li>
<li>[x] POKE -16297/49239/$C057 - undocumented display control</li>
</ul>
<h3><a class="anchor" id="autotoc_md134"></a>
Annunciator Outputs</h3>
<ul>
<li>[x] POKE -16296/49240/$C058 - turn off annunciator 0</li>
<li>[x] POKE -16295/49241/$C059 - turn on annunciator 0</li>
<li>[x] POKE -16294/49242/$C05A - turn off annunciator 1</li>
<li>[x] POKE -16293/49243/$C05B - turn on annunciator 1</li>
<li>[x] POKE -16292/49244/$C05C - turn off annunciator 2</li>
<li>[x] POKE -16291/49245/$C05D - turn on annunciator 2</li>
<li>[x] POKE -16290/49246/$C05E - turn off annunciator 3</li>
<li>[x] POKE -16289/49247/$C05F - turn on annunciator 3</li>
</ul>
<h3><a class="anchor" id="autotoc_md135"></a>
Graphics Memory</h3>
<ul>
<li>[x] POKE 103/$67 - hi-res page pointer (low byte)</li>
<li>[x] POKE 104/$68 - hi-res page pointer (high byte)</li>
<li>[x] POKE 16384/$4000 - page-specific graphics control</li>
<li>[x] POKE 24576/$6000 - page-specific graphics control</li>
</ul>
<h3><a class="anchor" id="autotoc_md136"></a>
Shape Tables</h3>
<ul>
<li>[x] POKE 232/$E8 - shape table pointer (low byte)</li>
<li>[x] POKE 233/$E9 - shape table pointer (high byte)</li>
</ul>
<h3><a class="anchor" id="autotoc_md137"></a>
Error Control</h3>
<ul>
<li>[x] POKE 216/$D8,0 - restore normal error handling</li>
</ul>
<h3><a class="anchor" id="autotoc_md138"></a>
System Calls (CALL addresses)</h3>
<ul>
<li>[x] CALL -3288/62248/$F318 - stack cleanup routine</li>
<li>[x] CALL -3086/62450/$F3F2 - clear hi-res page to black</li>
<li>[x] CALL -3082/62454/$F3F6 - clear hi-res to last HPLOT color</li>
<li>[x] CALL -1998/63538/$F832 - BKGND (background color)</li>
<li>[x] CALL -958/64578/$FC42 - clear from cursor to bottom-right</li>
<li>[x] CALL -936/64600/$FC58 - HOME (clear screen, home cursor)</li>
<li>[x] CALL -922/64614/$FC66 - line feed</li>
<li>[x] CALL -912/64624/$FC70 - scroll text window up</li>
<li>[x] CALL -868/64668/$FC9C - CLREOL (clear to end of line)</li>
<li>[x] CALL -151/65385/$FF69 - enter Monitor</li>
<li>[x] CALL 768/$300 - common user ML routine location (page 3)</li>
<li>[x] CALL 1002/$3EA - restore ProDOS connection (ProDOS only)</li>
</ul>
<h2><a class="anchor" id="autotoc_md139"></a>
Graphics Implementation</h2>
<h3><a class="anchor" id="autotoc_md140"></a>
No-Graphics Mode</h3>
<ul>
<li>[x] Terminal output with ANSI/xterm escape sequences</li>
<li>[x] Error handling for graphics commands ("GRAPHICS NOT ENABLED ERROR")</li>
<li>[x] Text commands (PRINT, HOME, HTAB, VTAB) work normally</li>
<li>[x] Runtime checking with <code>requireGraphicsMode()</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md141"></a>
Graphics Mode - Display Window</h3>
<ul>
<li>[x] 280×192 pixel resolution (Apple II standard)</li>
<li>[x] Configurable scaling (1-10x) via <code>--scale</code> flag</li>
<li>[x] Raylib 5.0+ backend (cross-platform)</li>
<li>[x] Graceful fallback for headless environments</li>
</ul>
<h3><a class="anchor" id="autotoc_md142"></a>
Graphics Mode - Build System</h3>
<ul>
<li>[x] Automatic Raylib build via FetchContent</li>
<li>[x] Optional building with <code>-DAUTO_BUILD_RAYLIB=OFF</code></li>
<li>[x] Dependency checking (X11 on Linux)</li>
<li>[x] Cross-platform support (Linux, macOS, Windows)</li>
</ul>
<h3><a class="anchor" id="autotoc_md143"></a>
Graphics Mode - Commands</h3>
<ul>
<li>[x] Mode switching: GR, HIRES, HGR, HGR2</li>
<li>[x] Color selection: COLOR=, HCOLOR=</li>
<li>[x] Pixel operations: PLOT, HPLOT</li>
<li>[x] Line drawing: HLIN, VLIN</li>
<li>[x] Shape drawing: DRAW, XDRAW</li>
<li>[x] Transformations: MOVE, ROTATE, SCALE</li>
<li>[x] Shape loading: SHLOAD</li>
<li>[x] Pixel queries: <a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921acc06370fc7df708112ed2e2a79bc3b4c">SCRN(x,y)</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md144"></a>
Graphics Mode - Text Mode Switching</h3>
<ul>
<li>[x] PR#0 - Switch to 40-column text mode</li>
<li>[x] PR#3 - Switch to 80-column text mode</li>
<li>[x] State tracking in <code><a class="el" href="structGraphicsConfig.html" title="Configuration for graphics and text rendering.">GraphicsConfig</a></code></li>
<li>[x] Automatic scaling based on mode</li>
</ul>
<h3><a class="anchor" id="autotoc_md145"></a>
Graphics Mode - Graphics Buffer</h3>
<ul>
<li>[x] Off-screen buffer always maintained</li>
<li>[x] Pixel-perfect rendering support</li>
<li>[x] Color values: 24-bit RGB or indexed Apple II colors</li>
<li>[x] Efficient buffer updates</li>
</ul>
<h2><a class="anchor" id="autotoc_md146"></a>
Font Integration</h2>
<h3><a class="anchor" id="autotoc_md147"></a>
Font Specifications</h3>
<ul>
<li>[x] Font bundled: The Ultimate Apple II Font (PrintChar21)</li>
<li>[x] Character cell size: 7×8 pixels</li>
<li>[x] TrueType (.ttf) format</li>
<li>[x] License file included (FreeLicense.txt)</li>
</ul>
<h3><a class="anchor" id="autotoc_md148"></a>
Bundled Font Files</h3>
<ul>
<li>[x] Font files tracked in git repository</li>
<li>[x] Three files bundled: PrintChar21.ttf, apple2-charset.html, FreeLicense.txt</li>
<li>[x] Optional refresh from upstream with <code>REFRESH_BUNDLED_FONTS</code> option</li>
<li>[x] Automatic download fallback if files missing</li>
<li>[x] Graceful handling of download failures</li>
<li>[x] Set availability flag <code>APPLE2_FONT_AVAILABLE</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md149"></a>
CI/CD Integration</h3>
<ul>
<li>[x] No download required for CI builds (files bundled)</li>
<li>[x] GitHub Actions caching still works (harmless redundancy)</li>
<li>[x] Reliable builds without network dependencies</li>
</ul>
<h3><a class="anchor" id="autotoc_md150"></a>
Font Loading Implementation</h3>
<ul>
<li>[x] Font file search in multiple paths</li>
<li>[x] Font loading via Raylib's <code>LoadFontEx()</code></li>
<li>[x] Error handling with validation</li>
<li>[x] Graceful fallback to default font</li>
<li>[x] Memory management (proper unloading)</li>
</ul>
<h3><a class="anchor" id="autotoc_md151"></a>
Character Rendering Implementation</h3>
<ul>
<li>[x] Font selection (Apple II or fallback)</li>
<li>[x] Scaling with <code>config_.scaleFactor</code></li>
<li>[x] Text mode handling (40-column and 80-column)</li>
<li>[x] Rendering via <code>DrawTextEx()</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md152"></a>
Text Rendering Implementation</h3>
<ul>
<li>[x] 40-column mode rendering</li>
<li>[x] 80-column mode with horizontal compression</li>
<li>[x] Character-by-character rendering for 80-column</li>
<li>[x] Color handling (RGB extraction)</li>
<li>[x] Font fallback support</li>
</ul>
<h2><a class="anchor" id="autotoc_md153"></a>
Remaining Work - Graphics</h2>
<ul>
<li>[x] Uncomment font loading code in <code>GraphicsRenderer::loadApple2Font()</code></li>
<li>[x] Test rendering in 40-column mode</li>
<li>[x] Test rendering in 80-column mode</li>
<li>[ ] Text rendering directly into graphics buffer</li>
<li>[ ] Mixed text/graphics mode display (4-line text + 160-line graphics)</li>
<li>[ ] More accurate Apple II color palette interpolation</li>
<li>[ ] Enhanced shape table support with standard Apple II shapes</li>
<li>[ ] HIRES page 2 graphics switching</li>
</ul>
<h2><a class="anchor" id="autotoc_md154"></a>
Implementation Completeness</h2>
<h3><a class="anchor" id="autotoc_md155"></a>
Overall Score: 98%</h3>
<h3><a class="anchor" id="autotoc_md156"></a>
Feature Category Status</h3>
<ul>
<li>[x] Core BASIC: 100% - All core Applesoft BASIC language features</li>
<li>[x] Built-in Functions: 100% - All standard math, string, and system functions</li>
<li>[x] <a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a>: 100% - Full Apple II graphics support (low-res and high-res)</li>
<li>[x] Display Control: 100% - Complete screen and cursor control</li>
<li>[x] Program Management: 100% - All program editing and execution commands</li>
<li>[x] Memory Operations: 100% - PEEK/POKE/CALL/WAIT fully functional</li>
<li>[x] Test Coverage: 90% - 66 test files + 9 example programs = 75 total test programs</li>
<li>[x] ProDOS Commands: 100% - All commands tokenized, parsed, and implemented</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md158"></a>
Part 2: Implementation Details &amp; Notes</h1>
<h2><a class="anchor" id="autotoc_md159"></a>
Graphics Architecture</h2>
<p>MSBasic implements two distinct graphics handling methods:</p>
<ol type="1">
<li><b>No-Graphics Mode</b> (Terminal-only)<ul>
<li>All output uses ANSI/xterm escape sequences</li>
<li><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> commands raise "GRAPHICS NOT ENABLED ERROR"</li>
<li>Useful for testing, CI/CD, headless environments</li>
<li>Enabled with <code>--no-graphics</code> command-line flag</li>
</ul>
</li>
<li><b><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> Mode</b> (Windowed display)<ul>
<li>Opens a 280×192 pixel display window via Raylib</li>
<li>Supports scalable rendering (<code>--scale N</code> flag, 1-10x)</li>
<li>Text and graphics rendering to off-screen buffer</li>
<li>Ultimate Apple II Font for authentic character rendering</li>
<li>Graceful fallback to terminal output if Raylib unavailable</li>
<li>Enabled with <code>--graphics</code> flag (default behavior)</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md160"></a>
Mode Selection</h3>
<p><b>Command-Line Flags:</b></p>
<ul>
<li><code>--no-graphics</code> — Force terminal-only mode (disable all graphics)</li>
<li><code>--graphics</code> — Enable graphics mode (default, requires Raylib/X11)</li>
<li><code>--scale N</code> — Scaling factor for graphics window (1-10, default: 1)<ul>
<li>Example: <code>--scale 2</code> opens 560×384 pixel window (2× scaling of 280×192)</li>
</ul>
</li>
</ul>
<p><b>Default Behavior:</b></p>
<ul>
<li><b>With X11/Raylib available</b>: <a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> mode enabled</li>
<li><b>Without display/Raylib</b>: Falls back to terminal-only mode</li>
<li><b>Explicit flag</b>: Overrides defaults</li>
</ul>
<h3><a class="anchor" id="autotoc_md161"></a>
No-Graphics Mode Behavior</h3>
<p><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> commands in no-graphics mode:</p>
<div class="fragment"><div class="line">10 GR        REM → Error: GRAPHICS NOT ENABLED ERROR</div>
<div class="line">20 HPLOT 100,100  REM → Error: GRAPHICS NOT ENABLED ERROR</div>
<div class="line">30 PRINT &quot;Text&quot;   REM → Works fine</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md162"></a>
Graphics Mode Usage Examples</h3>
<p><b>No-Graphics Mode:</b></p>
<div class="fragment"><div class="line">./msbasic --no-graphics program.bas</div>
</div><!-- fragment --><p><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> commands error; all text I/O uses terminal.</p>
<p><b><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> Mode with Scaling:</b></p>
<div class="fragment"><div class="line">./msbasic --graphics --scale 2 program.bas</div>
</div><!-- fragment --><p>Opens 560×384 pixel window (2× scaling).</p>
<p><b>Text Mode Switching:</b></p>
<div class="fragment"><div class="line">10 PR#0        REM 40-column mode (280 pixels)</div>
<div class="line">20 PRINT &quot;40-COLUMN TEXT&quot;</div>
<div class="line">30 PR#3        REM 80-column mode (horizontal compression)</div>
<div class="line">40 PRINT &quot;80-COLUMN TEXT&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md163"></a>
Graphics Implementation Details</h3>
<p><b>Mode Detection:</b></p>
<div class="fragment"><div class="line"><span class="comment">// Runtime check for graphics availability</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classInterpreter.html#a3df7e03e113988f8a3cc0a61de8a1f82">Interpreter::requireGraphicsMode</a>()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (!graphicsConfig_.<a class="code hl_function" href="structGraphicsConfig.html#a51da2294720b69bda15e80ff78a0f3f2">isGraphicsEnabled</a>()) {</div>
<div class="line">        <a class="code hl_function" href="classInterpreter.html#a235ede0400db02479844e4f9178f27c9">handleError</a>(<span class="stringliteral">&quot;GRAPHICS NOT ENABLED ERROR&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassInterpreter_html_a235ede0400db02479844e4f9178f27c9"><div class="ttname"><a href="classInterpreter.html#a235ede0400db02479844e4f9178f27c9">Interpreter::handleError</a></div><div class="ttdeci">void handleError(const std::string &amp;message)</div><div class="ttdoc">Throw a runtime error.</div><div class="ttdef"><b>Definition</b> <a href="interpreter_8cpp_source.html#l03211">interpreter.cpp:3211</a></div></div>
<div class="ttc" id="aclassInterpreter_html_a3df7e03e113988f8a3cc0a61de8a1f82"><div class="ttname"><a href="classInterpreter.html#a3df7e03e113988f8a3cc0a61de8a1f82">Interpreter::requireGraphicsMode</a></div><div class="ttdeci">void requireGraphicsMode() const</div><div class="ttdoc">Verify graphics operations are allowed.</div><div class="ttdef"><b>Definition</b> <a href="interpreter_8cpp_source.html#l03567">interpreter.cpp:3567</a></div></div>
<div class="ttc" id="astructGraphicsConfig_html_a51da2294720b69bda15e80ff78a0f3f2"><div class="ttname"><a href="structGraphicsConfig.html#a51da2294720b69bda15e80ff78a0f3f2">GraphicsConfig::isGraphicsEnabled</a></div><div class="ttdeci">bool isGraphicsEnabled() const</div><div class="ttdoc">Check if graphics operations are enabled.</div><div class="ttdef"><b>Definition</b> <a href="graphics__config_8h_source.html#l00056">graphics_config.h:56</a></div></div>
</div><!-- fragment --><p><b>Text Mode Rendering:</b></p>
<ul>
<li>40-column mode: Character width = 7 pixels × scaleFactor</li>
<li>80-column mode: Character width = 3.5 pixels × scaleFactor (0.5× horizontal compression)</li>
</ul>
<p><b>Display Control:</b></p>
<ul>
<li>POKE addresses for mode switching (documented in PEEK/POKE section)</li>
<li>Memory-mapped display control emulated via <code><a class="el" href="functions_8cpp.html#a47f17747b5c6e0ee2fc6a8580c5284d7" title="Write a byte value to memory (POKE implementation)">pokeMemory()</a></code></li>
</ul>
<h3><a class="anchor" id="autotoc_md164"></a>
Platform Support</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform   </th><th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Linux   </td><td class="markdownTableBodyNone">✅ Full support   </td><td class="markdownTableBodyNone">Requires X11/Xwayland    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">macOS   </td><td class="markdownTableBodyNone">✅ Full support   </td><td class="markdownTableBodyNone">Native Cocoa backend    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows   </td><td class="markdownTableBodyNone">✅ Full support   </td><td class="markdownTableBodyNone">Native Win32 backend   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md165"></a>
CMake Build Options</h3>
<div class="fragment"><div class="line"># Build with automatic Raylib (default)</div>
<div class="line">cmake -S . -B build</div>
<div class="line"> </div>
<div class="line"># Build without automatic Raylib</div>
<div class="line">cmake -DAUTO_BUILD_RAYLIB=OFF -S . -B build</div>
<div class="line"> </div>
<div class="line"># Specify custom Raylib location</div>
<div class="line">cmake -DRAYLIB_ROOT=/path/to/raylib -S . -B build</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md166"></a>
Variable Names</h2>
<p>Variable names are significant to first 2 characters (case-insensitive):</p>
<ul>
<li>Exception: <code>FN</code> names preserve 3 characters (e.g., <code>FNx</code>)</li>
<li><code>$</code> suffix denotes string variables</li>
<li><code>%</code> suffix denotes integer variables (clamped to 16-bit signed range)</li>
</ul>
<h2><a class="anchor" id="autotoc_md167"></a>
Arrays</h2>
<p>Arrays have the following behavior:</p>
<ul>
<li>Auto-dimension to size 10 per dimension if undeclared</li>
<li><a class="el" href="classExpression.html" title="Base class for all expression AST nodes.">Expression</a> subscripts supported</li>
<li>Bounds checking yields "BAD SUBSCRIPT" error</li>
<li>Shared get/set access path</li>
</ul>
<h2><a class="anchor" id="autotoc_md168"></a>
DATA/READ/RESTORE</h2>
<p>Data handling follows these rules:</p>
<ul>
<li>DATA collected pre-run before program execution</li>
<li>READ consumes sequentially across control flow</li>
<li>RESTORE can optionally target a specific line number</li>
<li>READ on exhausted data raises "OUT OF DATA" error</li>
</ul>
<h2><a class="anchor" id="autotoc_md169"></a>
Graphics</h2>
<p><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> features include:</p>
<ul>
<li>GR/HIRES configure scaled overlay window</li>
<li>Shape table support with default shapes (triangle, square)</li>
<li>User-defined shapes via SHLOAD (DATA-driven format)</li>
<li>DRAW/XDRAW apply rotation (ROTATE) and scale (SCALE) transforms</li>
<li>XDRAW implements XOR behavior (toggling pixels)</li>
<li><a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921acc06370fc7df708112ed2e2a79bc3b4c">SCRN(x,y)</a> queries pixel buffer and returns color</li>
<li><b>No on-screen rendering yet</b> - graphics buffer only</li>
</ul>
<h2><a class="anchor" id="autotoc_md170"></a>
Memory Model</h2>
<p>Memory handling:</p>
<ul>
<li>LOMEM/HIMEM boundaries enforced for PEEK/POKE/WAIT</li>
<li>Simple in-memory model for PEEK/POKE operations</li>
<li>CALL is currently a no-op</li>
<li><a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a2b6cc9c30eaad9c109091ea928529cbd">USR(addr)</a> stub returns 0</li>
</ul>
<h2><a class="anchor" id="autotoc_md171"></a>
Output Behavior</h2>
<p>Output features:</p>
<ul>
<li>CHR$(7) emits terminal bell (<code>\a</code>) and flushes immediately</li>
<li>POS reports current column using:<ul>
<li>ANSI query on POSIX systems</li>
<li>Windows console API on Windows</li>
<li>Falls back to 0 if unavailable</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md172"></a>
Device Control Behavior</h2>
<p>Device handling:</p>
<ul>
<li>PR::n and IN::n store device slots but keep screen/keyboard active</li>
<li>No actual device redirection implemented yet</li>
</ul>
<h2><a class="anchor" id="autotoc_md173"></a>
File I/O</h2>
<p>File operations:</p>
<ul>
<li>Basic LOAD/SAVE/CATALOG implemented</li>
<li>RECALL/STORE for arrays implemented</li>
<li>ProDOS extended file operations not yet fully implemented</li>
</ul>
<h2><a class="anchor" id="autotoc_md174"></a>
Testing</h2>
<p>Testing infrastructure:</p>
<ul>
<li>Test suite location: <code>tests/</code> directory</li>
<li>Tests are <code>.bas</code> programs executed via <code>ctest --test-dir build</code></li>
<li>Run tests: <code>ctest --test-dir build --output-on-failure</code></li>
<li>Always add <code>.bas</code> test programs for new features</li>
</ul>
<h2><a class="anchor" id="autotoc_md175"></a>
Build and Development</h2>
<p>Build instructions:</p>
<ul>
<li>Build: <code>cmake -S . -B build &amp;&amp; cmake --build build</code></li>
<li>VS Code task: <code>build-msbasic</code> builds the <code>msbasic</code> target</li>
<li>Version: Generated from <code>src/version.h.in</code> using <code>git describe</code></li>
<li>REPL: <code>./build/msbasic</code> (interactive mode)</li>
<li>Run script: <code>./build/msbasic path/to/program.bas</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md176"></a>
Known Limitations</h2>
<h3><a class="anchor" id="autotoc_md177"></a>
Hardware-Specific Features (By Design)</h3>
<p>The following Apple II hardware features are stubs or simulations:</p>
<ul>
<li><b><a class="el" href="types_8h.html#aa520fbf142ba1e7e659590c07da31921a4e0799443cae591e21badb40f9a20754">PDL(n)</a></b> - Paddle input: Returns 0 (no game controller connected)</li>
<li><b>Keyboard PEEK</b> - Returns stub value (uses GET for input)</li>
<li><b>Button inputs</b> - PEEK(49249-49251)/PEEK($C061-$C063): Returns 0</li>
<li><b>Speaker sound</b> - PEEK/POKE to speaker address: No-op</li>
<li><b>Annunciators</b> - PEEK/POKE 49240-49247/$C058-$C05F: Stored but no hardware effect</li>
</ul>
<p>These limitations are acceptable for a modern BASIC interpreter.</p>
<h3><a class="anchor" id="autotoc_md178"></a>
ProDOS File Operations (Partially Implemented)</h3>
<p>ProDOS commands are <b>tokenized</b> but implementation status varies:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Tokenized   </th><th class="markdownTableHeadNone">Implemented   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CAT/CATALOG   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Directory listing works    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">LOAD/SAVE   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Program file I/O works    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BLOAD/BSAVE   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Binary file I/O implemented    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OPEN/CLOSE   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">File open/close implemented    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">READ/WRITE   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">ProDOS READ/WRITE implemented    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">APPEND   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Append mode supported    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">POSITION   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">File positioning implemented    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DELETE/RENAME   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">File operations work    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CREATE   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">File/directory creation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">LOCK/UNLOCK   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">File permission operations (stub)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PREFIX   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Working directory show/set    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FLUSH   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Buffer flushing implemented    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">EXEC   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Command file execution implemented    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CHAIN   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Program chaining with start line    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">- (dash)   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">✅   </td><td class="markdownTableBodyNone">Run without clearing vars   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md179"></a>
Test Coverage Details</h2>
<h3><a class="anchor" id="autotoc_md180"></a>
Tests Present (75 total test programs)</h3>
<p>Sample test categories:</p>
<ul>
<li><b>Language Features</b>: arrays, data/read, def_fn, for, gosub, if, integers, strings, operators</li>
<li><b><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a></b>: graphics_basic, graphics_modes, hplot, draw, plot, vlin</li>
<li><b>System</b>: peek/poke addresses, memory range, call, wait</li>
<li><b>File I/O</b>: bsave/bload, catalog, delete, create, chain</li>
<li><b>Control Flow</b>: cont, on_goto, while_wend, stop</li>
<li><b>Error Handling</b>: onerr_resume</li>
<li><b>ProDOS</b>: Several ProDOS command tests</li>
</ul>
<p><b>Test Execution:</b></p>
<p>Running tests with ctest:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">ctest --output-on-failure</div>
</div><!-- fragment --><p>All core feature tests pass successfully.</p>
<h2><a class="anchor" id="autotoc_md181"></a>
Future Enhancement Recommendations</h2>
<h3><a class="anchor" id="autotoc_md182"></a>
Priority 1: Enhance File I/O (Medium Effort)</h3>
<p>Improve ProDOS file operations:</p>
<ol type="1">
<li>Add comprehensive tests for OPEN/CLOSE/READ/WRITE</li>
<li>Implement APPEND file mode</li>
<li>Add POSITION (file seeking)</li>
<li>Test FLUSH operation</li>
<li>Implement EXEC (command file execution)</li>
</ol>
<p><b>Estimated Effort:</b> 8-16 hours</p>
<h3><a class="anchor" id="autotoc_md183"></a>
Priority 2: Complete Graphics Font Integration (Low Effort)</h3>
<p>Complete the graphics text rendering:</p>
<ol type="1">
<li>✅ Font auto-fetching implemented (automatic download during build)</li>
<li>✅ Font files cached in CI to avoid repeated downloads</li>
<li>Implement actual font loading in <code>GraphicsRenderer::loadApple2Font()</code> (currently stubbed)</li>
<li>Test text rendering in graphics modes with loaded font</li>
<li>Verify 40-column and 80-column display</li>
</ol>
<p><b>Estimated Effort:</b> 2-4 hours</p>
<h3><a class="anchor" id="autotoc_md184"></a>
Priority 3: Add More Examples (Low Effort)</h3>
<p>Create example programs demonstrating:</p>
<ol type="1">
<li>ProDOS file operations</li>
<li>ONERR error handling</li>
<li>User-defined functions</li>
<li><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> and shape tables</li>
<li>WHILE/WEND loops</li>
</ol>
<p><b>Estimated Effort:</b> 4-8 hours</p>
<h3><a class="anchor" id="autotoc_md185"></a>
Priority 4: Documentation (Low Effort)</h3>
<p>Enhance user documentation:</p>
<ol type="1">
<li>Command reference with examples</li>
<li>ProDOS file operation guide</li>
<li><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> programming guide</li>
<li>Migration guide from Applesoft</li>
</ol>
<p><b>Estimated Effort:</b> 8-12 hours</p>
<h2><a class="anchor" id="autotoc_md186"></a>
Production Readiness</h2>
<p><b>Status:</b> ✅ <b>Production Ready</b></p>
<p>The interpreter is production-ready for:</p>
<ul>
<li>Educational purposes</li>
<li>Running vintage Applesoft programs</li>
<li><a class="el" href="classGraphics.html" title="Singleton managing graphics state and operations.">Graphics</a> programming</li>
<li>Cross-platform BASIC development</li>
</ul>
<h2><a class="anchor" id="autotoc_md187"></a>
Code Quality</h2>
<h3><a class="anchor" id="autotoc_md188"></a>
Security</h3>
<ul>
<li><b>CodeQL Scan Result</b>: 0 alerts ✅</li>
<li>Safe file handling with proper error checking</li>
<li>No memory leaks or resource issues</li>
<li>Cross-platform compatibility maintained</li>
</ul>
<h3><a class="anchor" id="autotoc_md189"></a>
Best Practices</h3>
<ul>
<li>Modern C++ (range-based loops, std::vector)</li>
<li>Clear variable naming</li>
<li>Comprehensive comments</li>
<li>Error handling with helpful messages</li>
<li>Cross-platform compatibility (<code>#ifdef</code> guards)</li>
</ul>
<h2><a class="anchor" id="autotoc_md190"></a>
Font Integration (Deep Dive)</h2>
<p><b>Overview:</b></p>
<p>MSBasic integrates <b>The Ultimate Apple II Font</b> to provide authentic Apple II text rendering. The font is automatically downloaded during the CMake build process, ensuring authentic 7×8 pixel character rendering without manual setup.</p>
<p><b>Font Specifications:</b></p>
<ul>
<li><b>Font Name</b>: The Ultimate Apple II Font (PrintChar21)</li>
<li><b>Source URL</b>: <a href="https://www.kreativekorp.com/software/fonts/apple2/">https://www.kreativekorp.com/software/fonts/apple2/</a></li>
<li><b>Character Set Map</b>: <a href="https://www.kreativekorp.com/charset/map/apple2/">https://www.kreativekorp.com/charset/map/apple2/</a></li>
<li><b>Format</b>: TrueType (.ttf)</li>
<li><b>Character Cell Size</b>: 7×8 pixels per character</li>
<li><b>License</b>: Free License from kreativekorp.com (see <code>assets/fonts/FreeLicense.txt</code>)</li>
</ul>
<p><b>Text Mode Support:</b></p>
<ul>
<li><b>40-column mode</b>: 280 pixels wide (40 chars × 7 pixels)<ul>
<li>Direct 7×8 pixel rendering</li>
<li>Standard character spacing</li>
</ul>
</li>
<li><b>80-column mode</b>: 560 pixels effective (80 chars × 7 pixels, scaled 0.5x horizontally to fit 280 pixels)<ul>
<li>Horizontal compression (3.5-pixel effective width)</li>
<li>Character-by-character rendering with adjusted spacing</li>
</ul>
</li>
<li><b>Screen Height</b>: 192 pixels (24 rows × 8 pixels)</li>
</ul>
<h3><a class="anchor" id="autotoc_md191"></a>
Automatic Font Fetching</h3>
<p>The build system automatically downloads required font files during CMake configuration:</p>
<p><b>How It Works:</b></p>
<ol type="1">
<li>Check for existing files: If font files exist in <code>assets/fonts/</code>, downloads are skipped (idempotent)</li>
<li>Create fonts directory: Creates <code>assets/fonts/</code> if needed</li>
<li>Download font: Fetches <code>PrintChar21.ttf</code> from kreativekorp.com (30-second timeout)</li>
<li>Download charset map: Fetches Apple II charset reference for developers (30-second timeout)</li>
<li>Download license: Fetches <code>FreeLicense.txt</code> from kreativekorp.com</li>
<li>Graceful fallback: If downloads fail, build continues with warnings; Raylib's default font is used at runtime</li>
<li>Set availability flag: Sets <code>APPLE2_FONT_AVAILABLE</code> CMake cache variable</li>
</ol>
<p><b>Files Downloaded:</b></p>
<ul>
<li><code>assets/fonts/PrintChar21.ttf</code> - The Ultimate Apple II Font (~50KB)</li>
<li><code>assets/fonts/apple2-charset.html</code> - Character set reference map (~20KB)</li>
<li><code>assets/fonts/FreeLicense.txt</code> - License file</li>
</ul>
<p><b>Download URLs:</b></p>
<ul>
<li><b>Font</b>: <code><a href="https://www.kreativekorp.com/swdownload/fonts/apple2/PrintChar21.ttf">https://www.kreativekorp.com/swdownload/fonts/apple2/PrintChar21.ttf</a></code></li>
<li><b>Charset Map</b>: <code><a href="https://www.kreativekorp.com/charset/map/apple2/">https://www.kreativekorp.com/charset/map/apple2/</a></code></li>
<li><b>License</b>: <code><a href="https://www.kreativekorp.com/software/fonts/FreeLicense.txt">https://www.kreativekorp.com/software/fonts/FreeLicense.txt</a></code></li>
</ul>
<p>URLs can be overridden via CMake variables:</p>
<div class="fragment"><div class="line">cmake -DAPPLE2_FONT_URL=&quot;https://alternative-source/font.ttf&quot; \</div>
<div class="line">      -DAPPLE2_CHARSET_URL=&quot;https://alternative-source/map.html&quot; \</div>
<div class="line">      -S . -B build</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md192"></a>
CI/CD Integration for Fonts</h3>
<p><b>GitHub Actions Caching:</b></p>
<p>The build workflow (<code>.github/workflows/build.yml</code>) caches downloaded fonts:</p>
<div class="fragment"><div class="line">- name: Cache Apple II fonts</div>
<div class="line">  uses: actions/cache@v4</div>
<div class="line">  with:</div>
<div class="line">    path: assets/fonts</div>
<div class="line">    key: apple2-fonts-${{ hashFiles(&#39;cmake/FetchFont.cmake&#39;) }}</div>
<div class="line">    restore-keys: |</div>
<div class="line">      apple2-fonts-</div>
</div><!-- fragment --><p>Benefits:</p>
<ul>
<li>Avoids repeated downloads in CI runs</li>
<li>Cache invalidated only when <code>cmake/FetchFont.cmake</code> changes</li>
<li>Speeds up build times significantly</li>
<li>Works across workflow runs without manual intervention</li>
</ul>
<h3><a class="anchor" id="autotoc_md193"></a>
Implementation Details</h3>
<p><b>CMake Module: <code>cmake/FetchFont.cmake</code></b></p>
<p>The <code>fetch_apple2_font()</code> function provides:</p>
<ul>
<li><b>Native CMake downloads</b>: Uses <code>file(DOWNLOAD ...)</code> command (no external tools needed)</li>
<li><b>Cross-platform</b>: Works on Linux, macOS, and Windows</li>
<li><b>Timeout handling</b>: 30-second timeout per download</li>
<li><b>TLS/SSL verification</b>: Enabled for security</li>
<li><b>Smart cleanup</b>: Removes partial downloads on failure</li>
<li><b>Idempotent operation</b>: Safe for repeated builds</li>
<li><b>Configurable URLs</b>: Supports custom font sources</li>
<li><b>Helpful error messages</b>: Guides users to manual installation</li>
</ul>
<p><b>Font Loading: <code>GraphicsRenderer::loadApple2Font()</code></b></p>
<ol type="1">
<li><b>Font File Search</b>: Checks multiple paths for <code>PrintChar21.ttf</code>:<ul>
<li><code>assets/fonts/PrintChar21.ttf</code> (relative to working directory)</li>
<li><code>../assets/fonts/PrintChar21.ttf</code> (one level up)</li>
<li><code>/usr/share/fonts/apple2/PrintChar21.ttf</code> (system-wide location)</li>
</ul>
</li>
<li><b>Font Loading</b>: Uses Raylib's <code>LoadFontEx()</code> function:<ul>
<li>Font size: 8 pixels (matching Apple II 7×8 character cell)</li>
<li>Character set: Default ASCII</li>
<li>Texture filter: <code>TEXTURE_FILTER_BILINEAR</code> for smooth scaling</li>
</ul>
</li>
<li><b>Error Handling</b>:<ul>
<li>Validates font texture ID after loading</li>
<li>Graceful fallback to Raylib's default font on failure</li>
<li>Comprehensive error messages guide users to manual installation</li>
</ul>
</li>
<li><b>Memory Management</b>:<ul>
<li>Font stored as <code>Font*</code> pointer (allows optional loading)</li>
<li>Properly unloaded in <code>shutdown()</code> method</li>
<li>Protected by <code>fontLoaded_</code> flag to prevent invalid access</li>
</ul>
</li>
</ol>
<p><b>Character Rendering: <code>drawChar()</code></b></p>
<p>Single character rendering implementation:</p>
<ol type="1">
<li><b>Font Selection</b>: Uses Apple II font if loaded, otherwise falls back to default</li>
<li><b>Scaling</b>: Applies <code>config_.scaleFactor</code> for window scaling (e.g., 2x → 16 pixels)</li>
<li><b>Text Mode Handling</b>:<ul>
<li>40-column mode: Normal 7-pixel character width</li>
<li>80-column mode: 0.5x horizontal scaling (3.5-pixel effective width)</li>
</ul>
</li>
<li><b>Rendering</b>: Uses <code>DrawTextEx()</code> for consistent font rendering</li>
</ol>
<p><b>Text Rendering: <code>drawText()</code></b></p>
<p>Multi-character text rendering:</p>
<ol type="1">
<li><b>40-Column Mode</b> (default):<ul>
<li>Direct rendering with <code>DrawTextEx()</code></li>
<li>Character spacing: 1 pixel × scaleFactor</li>
<li>Character width: 7 pixels × scaleFactor</li>
</ul>
</li>
<li><b>80-Column Mode</b> (horizontal compression):<ul>
<li>Character-by-character rendering loop</li>
<li>X-position adjusted by <code>7 × scaleFactor × 0.5</code> per character</li>
<li>Effective character width: 3.5 pixels (7 × 0.5)</li>
<li>Results in 80 characters fitting in 280 pixels</li>
</ul>
</li>
<li><b>Color Handling</b>: RGB color values extracted from 24-bit integer</li>
<li><b>Font Fallback</b>: Uses Raylib default font if Apple II font unavailable</li>
</ol>
<p><b>Text Mode Detection:</b></p>
<ul>
<li>Uses <code>config_.textMode</code> from <code><a class="el" href="structGraphicsConfig.html" title="Configuration for graphics and text rendering.">GraphicsConfig</a></code></li>
<li><code><a class="el" href="graphics__config_8h.html#a55362bc0aeda7fca6f18d4be3d0d1c06ac0da43f7ec247209faff9a8d73711230" title="40×24 text mode (Applesoft default)">TextMode::Text40</a></code>: Standard 40×24 text mode (7-pixel chars)</li>
<li><code><a class="el" href="graphics__config_8h.html#a55362bc0aeda7fca6f18d4be3d0d1c06a670c82950236d7b6d1134b758b25f53f" title="80×24 text mode (via PR#3 slot redirection)">TextMode::Text80</a></code>: 80×24 text mode with horizontal compression (3.5-pixel effective width)</li>
</ul>
<h3><a class="anchor" id="autotoc_md194"></a>
Manual Installation</h3>
<p>If automatic download fails (e.g., network restrictions or blocked domains):</p>
<ol type="1">
<li>Download from: <a href="https://www.kreativekorp.com/software/fonts/apple2/">https://www.kreativekorp.com/software/fonts/apple2/</a></li>
<li>Save <code>PrintChar21.ttf</code> to <code>assets/fonts/PrintChar21.ttf</code></li>
<li>Optionally download charset map from: <a href="https://www.kreativekorp.com/charset/map/apple2/">https://www.kreativekorp.com/charset/map/apple2/</a></li>
<li>Save as <code>assets/fonts/apple2-charset.html</code></li>
<li>Re-run <code>cmake</code> - it will detect the existing files</li>
</ol>
<h3><a class="anchor" id="autotoc_md195"></a>
Troubleshooting</h3>
<p><b>Download Fails:</b></p>
<p>If you see warnings like: <code>CMake Warning: Failed to download font: "Could not resolve hostname"</code></p>
<p><b>Solutions:</b></p>
<ol type="1">
<li>Check your network connection</li>
<li>Manually download the font (see Manual Installation above)</li>
<li>If kreativekorp.com is blocked, contact your network administrator</li>
<li><p class="startli">Use an alternative font source:</p>
<div class="fragment"><div class="line">cmake -DAPPLE2_FONT_URL=&quot;https://alternative-source.com/PrintChar21.ttf&quot; ..</div>
</div><!-- fragment --></li>
<li>The build continues without the font - graphics mode uses Raylib's default font</li>
</ol>
<p><b>Font Not Loading:</b></p>
<p>If the font file exists but doesn't render correctly:</p>
<ol type="1">
<li>Check you're running in a graphics-enabled environment (X11 display available)</li>
<li>Verify the font file is not corrupted (should be ~50KB)</li>
<li>Check console output for font loading messages</li>
<li>The system automatically falls back to Raylib's default font if loading fails</li>
</ol>
<h3><a class="anchor" id="autotoc_md196"></a>
Version Control</h3>
<p>Downloaded fonts are excluded from version control via <code>.gitignore</code>:</p>
<div class="fragment"><div class="line"># Auto-downloaded assets</div>
<div class="line">assets/fonts/PrintChar21.ttf</div>
<div class="line">assets/fonts/apple2-charset.html</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md197"></a>
Alternative Approach</h3>
<p>If direct font integration proves complex, consider:</p>
<ol type="1">
<li>Using a pre-rendered bitmap atlas (256 characters in a grid)</li>
<li>Store as PNG or embedded C array</li>
<li>More control over pixel-perfect rendering</li>
<li>Faster rendering without font rasterization overhead </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 23 2025 21:51:54 for MSBasic - Applesoft BASIC Interpreter by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
